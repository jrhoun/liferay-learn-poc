
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Implementing a New Shipping Engine &#8212; Liferay Learn</title>
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<header role="navigation">
    <div class="brand">
        <a class="company-logo" href="../../../index.html" title="Home">
            <img src="../../../_static/liferay-waffle.svg" alt="Logo" />
        </a>
        <h2 class="header-title">
            <a href="../../../index.html">Documentation</a>
        </h2>
    </div>
    <div class="header-links" role="navigation" aria-label="related navigation">
        <a href="www.liferay.com">
            Liferay.com
        </a>
        <a href="">
            Training
        </a>
        <a href="">
            Community
        </a>
        <a href="help.liferay.com">
            Help Center
        </a>
    </div>
</header>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="implementing-a-new-shipping-engine">
<h1>Implementing a New Shipping Engine<a class="headerlink" href="#implementing-a-new-shipping-engine" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will show you how to add a custom shipping engine by implementing the <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-api/src/main/java/com/liferay/commerce/model/CommerceShippingEngine.java">CommerceShippingEngine</a> interface.</p>
<p>Shipping engines process shipping options to determine which of the available options will be shown to the user, for what price, and so on. Liferay Commerce provides three shipping engines out-of-the-box: a <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-shipping-engine-fixed-web/src/main/java/com/liferay/commerce/shipping/engine/fixed/web/internal/FixedCommerceShippingEngine.java">flat rate engine</a>, a <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-shipping-engine-fixed-web/src/main/java/com/liferay/commerce/shipping/engine/fixed/web/internal/ByWeightCommerceShippingEngine.java">variable rate engine</a>, and the <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-shipping-engine-fedex/src/main/java/com/liferay/commerce/shipping/engine/fedex/internal/FedExCommerceShippingEngine.java">FedEx engine</a>.</p>
<blockquote>
<div><p>The FedEx shipping engine is only available for Commerce Enterprise Subscribers.</p>
</div></blockquote>
<p><img alt="Out-of-the-box shipping methods" src="../../../_images/018.png" /></p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#deploy-an-example"><strong>Deploy an Example</strong></a></p></li>
<li><p><a class="reference external" href="#walk-through-the-example"><strong>Walk Through the Example</strong></a></p></li>
<li><p><a class="reference external" href="#additional-information"><strong>Additional Information</strong></a></p></li>
</ol>
</div>
<div class="section" id="deploy-an-example">
<h2>Deploy an Example<a class="headerlink" href="#deploy-an-example" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will get an example shipping engine up and running on your instance of Liferay Commerce. Follow these steps:</p>
<ol>
<li><p>Start Liferay Commerce.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it -p <span class="m">8080</span>:8080 liferay/commerce:2.0.5
</pre></div>
</div>
</li>
<li><p>Download and unzip <a class="reference external" href="#">Acme Commerce Shipping Engine</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl liferay-j6x8.zip
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>unzip liferay-j6x8.zip
</pre></div>
</div>
</li>
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">liferay-j6x8</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> liferay-j6x8
</pre></div>
</div>
</li>
<li><p>Build and deploy the example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gradlew deploy -Ddeploy.docker.container.id<span class="o">=</span><span class="k">$(</span>docker ps -lq<span class="k">)</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note:</strong> This command is the same as copying the deployed jars to /opt/liferay/osgi/modules on the Docker container.</p>
</div></blockquote>
</li>
<li><p>Confirm the deployment in the Docker container console.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>STARTED com.acme.j6x8.impl_1.0.0
</pre></div>
</div>
</li>
<li><p>Verify that the example shipping engine was added. Open your browser to <code class="docutils literal notranslate"><span class="pre">https://localhost:8080</span></code> and navigate to <em>Site Administration</em> → <em>Commerce</em> → <em>Settings</em> → <em>Shipping Methods</em>. The new shipping method (“Discounted Rate”) representing our shipping engine will be present on this screen.</p></li>
</ol>
<p><img alt="New shipping method" src="../../../_images/027.png" /></p>
<p>Congratulations, you’ve successfully built and deployed a new shipping engine that implements <code class="docutils literal notranslate"><span class="pre">CommerceShippingEngine</span></code>.</p>
<p>Next, let’s dive deeper to learn more.</p>
</div>
<div class="section" id="walk-through-the-example">
<h2>Walk Through the Example<a class="headerlink" href="#walk-through-the-example" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will review the example we deployed. First, we will annotate the class for OSGi registration. Second, we will review the <code class="docutils literal notranslate"><span class="pre">CommerceShippingEngine</span></code> interface. And third, we will complete our implementation of <code class="docutils literal notranslate"><span class="pre">CommerceShippingEngine</span></code>.</p>
<div class="section" id="annotate-the-class-for-osgi-registration">
<h3>Annotate the Class for OSGi Registration<a class="headerlink" href="#annotate-the-class-for-osgi-registration" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Component</span><span class="o">(</span>
    <span class="n">immediate</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
    <span class="n">property</span> <span class="o">=</span> <span class="s">&quot;commerce.shipping.engine.key=&quot;</span> <span class="o">+</span> <span class="n">J6X8CommerceShippingEngine</span><span class="o">.</span><span class="na">KEY</span><span class="o">,</span>
    <span class="n">service</span> <span class="o">=</span> <span class="n">CommerceShippingEngine</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">J6X8CommerceShippingEngine</span> <span class="kd">implements</span> <span class="n">CommerceShippingEngine</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">KEY</span> <span class="o">=</span> <span class="s">&quot;Example&quot;</span><span class="o">;</span>
</pre></div>
</div>
<blockquote>
<div><p>It is important to provide a distinct key for the shipping engine so that Liferay Commerce can distinguish the new engine from others in the <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-service/src/main/java/com/liferay/commerce/internal/util/CommerceShippingEngineRegistryImpl.java">shipping engine registry</a>. Reusing a key that is already in use will override the existing associated engine.</p>
</div></blockquote>
</div>
<div class="section" id="review-the-commerceshippingengine-interface">
<h3>Review the <code class="docutils literal notranslate"><span class="pre">CommerceShippingEngine</span></code> Interface<a class="headerlink" href="#review-the-commerceshippingengine-interface" title="Permalink to this headline">¶</a></h3>
<p>Implement the following methods:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">getCommerceShippingOptionLabel</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">);</span>
</pre></div>
</div>
<blockquote>
<div><p>This method returns a text label used for shipping options. See the implementation in <a class="reference external" href="./implementing-a-new-shipping-engine/liferay-j6x8.zip/j6x8-impl/src/main/java/com/acme/j6x8/internal/commerce/model/J6X8CommerceShippingEngine.java">J6X8CommerceShippingEngine.java</a> for a reference in retrieving the description with a language key.</p>
<p>See <a class="reference external" href="https://help.liferay.com/hc/en-us/articles/360018168251-Localizing-Your-Application">Localizing Your Application</a> for more information.</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingOption</span><span class="o">&gt;</span> <span class="nf">getCommerceShippingOptions</span><span class="o">(</span>
        <span class="n">CommerceContext</span> <span class="n">commerceContext</span><span class="o">,</span> <span class="n">CommerceOrder</span> <span class="n">commerceOrder</span><span class="o">,</span>
        <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">CommerceShippingEngineException</span><span class="o">;</span>
</pre></div>
</div>
<blockquote>
<div><p>This will be where we add the business logic for our custom shipping engine. It must fetch a list of available options, then perform the processing necessary to present them to the customer.</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">(</span><span class="n">Locale</span> <span class="n">locale</span><span class="o">);</span>
</pre></div>
</div>
<blockquote>
<div><p>This returns a brief description of our shipping engine. It works similarly to the <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptionLabel</span></code> method.</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">(</span><span class="n">Locale</span> <span class="n">locale</span><span class="o">);</span>
</pre></div>
</div>
<blockquote>
<div><p>This returns the name of our shipping engine to display in the UI. It also works similarly to the <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptionLabel</span></code> and <code class="docutils literal notranslate"><span class="pre">getDescription</span></code> methods.</p>
</div></blockquote>
</div>
<div class="section" id="complete-the-shipping-engine">
<h3>Complete the Shipping Engine<a class="headerlink" href="#complete-the-shipping-engine" title="Permalink to this headline">¶</a></h3>
<p>The shipping engine is comprised of backend logic preparing the list of shipping options to be shown to the customer. This logic is best implemented by splitting it into multiple steps. Do the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="#implement-getting-the-available-shipping-options">Implement getting the available shipping options.</a></p></li>
<li><p><a class="reference external" href="#implement-address-restriction-checking">Implement address restriction checking.</a></p></li>
<li><p><a class="reference external" href="#implement-a-loop-to-process-the-options">Implement a loop to process the options.</a></p></li>
<li><p><a class="reference external" href="#call-processing-logic-from-getcommerceshippingoptions">Call processing logic from <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptions</span></code>.</a></p></li>
<li><p><a class="reference external" href="#add-the-language-keys-to-languageproperties">Add the language keys to <code class="docutils literal notranslate"><span class="pre">Language.properties</span></code>.</a></p></li>
</ul>
<p>Liferay Commerce’s <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-shipping-engine-fixed-web/src/main/java/com/liferay/commerce/shipping/engine/fixed/web/internal/FixedCommerceShippingEngine.java">fixed rate shipping engine</a> is a good reference to see what processing steps are a good baseline to start with. Our example will follow the same steps.</p>
<div class="section" id="implement-getting-the-available-shipping-options">
<h4>Implement Getting the Available Shipping Options<a class="headerlink" href="#implement-getting-the-available-shipping-options" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingFixedOption</span><span class="o">&gt;</span> <span class="nf">_getCommerceShippingFixedOptions</span><span class="o">(</span>
    <span class="kt">long</span> <span class="n">groupId</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">CommerceShippingMethod</span> <span class="n">commerceShippingMethod</span> <span class="o">=</span>
        <span class="n">_commerceShippingMethodLocalService</span><span class="o">.</span><span class="na">fetchCommerceShippingMethod</span><span class="o">(</span>
            <span class="n">groupId</span><span class="o">,</span> <span class="n">KEY</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">commerceShippingMethod</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">_commerceShippingFixedOptionLocalService</span><span class="o">.</span>
        <span class="nf">getCommerceShippingFixedOptions</span><span class="o">(</span>
            <span class="n">commerceShippingMethod</span><span class="o">.</span><span class="na">getCommerceShippingMethodId</span><span class="o">(),</span>
            <span class="n">QueryUtil</span><span class="o">.</span><span class="na">ALL_POS</span><span class="o">,</span> <span class="n">QueryUtil</span><span class="o">.</span><span class="na">ALL_POS</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<blockquote>
<div><p>First, use <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-service/src/main/java/com/liferay/commerce/service/impl/CommerceShippingMethodLocalServiceImpl.java">CommerceShippingMethodLocalService</a> to get the “shipping method” (representing our shipping engine), and then use <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-shipping-engine-fixed-service/src/main/java/com/liferay/commerce/shipping/engine/fixed/service/impl/CommerceShippingFixedOptionLocalServiceImpl.java">CommerceShippingFixedOptionLocalService</a> to get the available options.</p>
</div></blockquote>
</div>
<div class="section" id="implement-address-restriction-checking">
<h4>Implement Address Restriction Checking<a class="headerlink" href="#implement-address-restriction-checking" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">_shippingOptionIsAddressRestricted</span><span class="o">(</span>
        <span class="n">CommerceOrder</span> <span class="n">commerceOrder</span><span class="o">,</span>
        <span class="n">CommerceShippingFixedOption</span> <span class="n">commerceShippingFixedOption</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">PortalException</span> <span class="o">{</span>

    <span class="n">CommerceAddress</span> <span class="n">commerceAddress</span> <span class="o">=</span> <span class="n">commerceOrder</span><span class="o">.</span><span class="na">getShippingAddress</span><span class="o">();</span>

    <span class="k">return</span> <span class="n">_commerceAddressRestrictionLocalService</span><span class="o">.</span>
        <span class="nf">isCommerceShippingMethodRestricted</span><span class="o">(</span>
            <span class="n">commerceShippingFixedOption</span><span class="o">.</span><span class="na">getCommerceShippingMethodId</span><span class="o">(),</span>
            <span class="n">commerceAddress</span><span class="o">.</span><span class="na">getCommerceCountryId</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<blockquote>
<div><p>The next step determines whether a particular shipping option is restricted for the order’s shipping address. A restricted option will not presented as an option to choose from.</p>
<p>Use <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-service/src/main/java/com/liferay/commerce/service/impl/CommerceAddressRestrictionLocalServiceImpl.java">CommerceAddressRestrictionLocalService</a> to determine if the option is restricted for the order’s address. Use <code class="docutils literal notranslate"><span class="pre">CommerceOrder</span></code> to get the address information; the <code class="docutils literal notranslate"><span class="pre">CommerceOrder</span></code> object represents all kinds of information about the order being shipped. See <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-api/src/main/java/com/liferay/commerce/model/CommerceOrder.java">CommerceOrder.java</a> and <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-api/src/main/java/com/liferay/commerce/model/CommerceOrderModel.java">CommerceOrderModel.java</a> to find more methods you can use with a <code class="docutils literal notranslate"><span class="pre">CommerceOrder</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="implement-a-loop-to-process-the-options">
<h4>Implement a Loop to Process the Options<a class="headerlink" href="#implement-a-loop-to-process-the-options" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingOption</span><span class="o">&gt;</span> <span class="nf">_getCommerceShippingOptions</span><span class="o">(</span>
        <span class="kt">long</span> <span class="n">groupId</span><span class="o">,</span> <span class="n">CommerceOrder</span> <span class="n">commerceOrder</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">PortalException</span> <span class="o">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingOption</span><span class="o">&gt;</span> <span class="n">commerceShippingOptions</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingFixedOption</span><span class="o">&gt;</span> <span class="n">commerceShippingFixedOptions</span> <span class="o">=</span>
        <span class="n">_getCommerceShippingFixedOptions</span><span class="o">(</span><span class="n">groupId</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">CommerceShippingFixedOption</span> <span class="n">commerceShippingFixedOption</span> <span class="o">:</span>
            <span class="n">commerceShippingFixedOptions</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">_shippingOptionIsAddressRestricted</span><span class="o">(</span>
            <span class="n">commerceOrder</span><span class="o">,</span> <span class="n">commerceShippingFixedOption</span><span class="o">))</span> <span class="o">{</span>

            <span class="k">continue</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">commerceShippingFixedOption</span><span class="o">.</span><span class="na">getName</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">_commerceShippingHelper</span><span class="o">.</span><span class="na">isFreeShipping</span><span class="o">(</span><span class="n">commerceOrder</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">commerceShippingOptions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">CommerceShippingOption</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">ZERO</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">BigDecimal</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">commerceShippingFixedOption</span><span class="o">.</span><span class="na">getAmount</span><span class="o">();</span>

        <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="n">DISCOUNT_RATE</span><span class="o">));</span>

        <span class="n">commerceShippingOptions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">CommerceShippingOption</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">amount</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">commerceShippingOptions</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<blockquote>
<div><p>The next step is to do most of the work in processing (using our previously defined helper methods), so we can more easily call it from the <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptions</span></code> method. In our example, we add an extra step at the end of the processing loop to multiply the amount for normally charged shipping options by a discounted rate.</p>
<p>Use the <a class="reference external" href="https://github.com/liferay/com-liferay-commerce/blob/2.0.5/commerce-service/src/main/java/com/liferay/commerce/internal/util/CommerceShippingHelperImpl.java">CommerceShippingHelper</a> to more easily determine if the order should be free.</p>
</div></blockquote>
</div>
<div class="section" id="call-processing-logic-from-getcommerceshippingoptions">
<h4>Call Processing Logic from <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptions</span></code><a class="headerlink" href="#call-processing-logic-from-getcommerceshippingoptions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingOption</span><span class="o">&gt;</span> <span class="nf">getCommerceShippingOptions</span><span class="o">(</span>
        <span class="n">CommerceContext</span> <span class="n">commerceContext</span><span class="o">,</span> <span class="n">CommerceOrder</span> <span class="n">commerceOrder</span><span class="o">,</span>
        <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">CommerceShippingEngineException</span> <span class="o">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">CommerceShippingOption</span><span class="o">&gt;</span> <span class="n">commerceShippingOptions</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">commerceShippingOptions</span> <span class="o">=</span> <span class="n">_getCommerceShippingOptions</span><span class="o">(</span>
            <span class="n">commerceContext</span><span class="o">.</span><span class="na">getSiteGroupId</span><span class="o">(),</span> <span class="n">commerceOrder</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">PortalException</span> <span class="n">pe</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">_log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">_log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="n">pe</span><span class="o">,</span> <span class="n">pe</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">commerceShippingOptions</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<blockquote>
<div><p>Call the processing logic defined previously from <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptions</span></code>, and handle any possible errors.</p>
</div></blockquote>
</div>
<div class="section" id="add-the-language-keys-to-language-properties">
<h4>Add the Language Keys to <code class="docutils literal notranslate"><span class="pre">Language.properties</span></code><a class="headerlink" href="#add-the-language-keys-to-language-properties" title="Permalink to this headline">¶</a></h4>
<p>Add the language keys and their values to a <a class="reference external" href="./implementing-a-new-shipping-engine/liferay-j6x8.zip/j6x8-impl/src/main/resources/content/Language.properties">Language.properties</a> file within our module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">discounted</span><span class="o">-</span><span class="n">rate</span><span class="o">=</span><span class="n">Discounted</span> <span class="n">Rate</span>
<span class="n">ship</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">discounted</span><span class="o">-</span><span class="n">price</span><span class="o">=</span><span class="n">Ship</span> <span class="k">for</span> <span class="n">a</span> <span class="n">discounted</span> <span class="n">price</span><span class="o">.</span>
</pre></div>
</div>
<blockquote>
<div><p>See <a class="reference external" href="https://help.liferay.com/hc/en-us/articles/360018168251-Localizing-Your-Application">Localizing Your Application</a> for more information.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Congratulations! You now know the basics for implementing the <code class="docutils literal notranslate"><span class="pre">CommerceShippingEngine</span></code> interface, and have added a new shipping engine to Liferay Commerce.</p>
</div>
<div class="section" id="additional-information">
<h2>Additional Information<a class="headerlink" href="#additional-information" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../user-guide/sales/applying-shipping-method-restrictions.html"><span class="doc">Applying Shipping Method Restrictions</span></a></p></li>
<li><p><a class="reference external" href="https://help.liferay.com/hc/en-us/articles/360018168251-Localizing-Your-Application">Localizing Your Application</a></p></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/liferay-waffle.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Implementing a New Shipping Engine</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#deploy-an-example">Deploy an Example</a></li>
<li><a class="reference internal" href="#walk-through-the-example">Walk Through the Example</a><ul>
<li><a class="reference internal" href="#annotate-the-class-for-osgi-registration">Annotate the Class for OSGi Registration</a></li>
<li><a class="reference internal" href="#review-the-commerceshippingengine-interface">Review the <code class="docutils literal notranslate"><span class="pre">CommerceShippingEngine</span></code> Interface</a></li>
<li><a class="reference internal" href="#complete-the-shipping-engine">Complete the Shipping Engine</a><ul>
<li><a class="reference internal" href="#implement-getting-the-available-shipping-options">Implement Getting the Available Shipping Options</a></li>
<li><a class="reference internal" href="#implement-address-restriction-checking">Implement Address Restriction Checking</a></li>
<li><a class="reference internal" href="#implement-a-loop-to-process-the-options">Implement a Loop to Process the Options</a></li>
<li><a class="reference internal" href="#call-processing-logic-from-getcommerceshippingoptions">Call Processing Logic from <code class="docutils literal notranslate"><span class="pre">getCommerceShippingOptions</span></code></a></li>
<li><a class="reference internal" href="#add-the-language-keys-to-language-properties">Add the Language Keys to <code class="docutils literal notranslate"><span class="pre">Language.properties</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li><a class="reference internal" href="#additional-information">Additional Information</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/commerce/developer-guide/tutorial/implementing-a-new-shipping-engine.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>